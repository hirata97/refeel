name: Auto-label Issues

on:
  issues:
    types: [opened, edited]

jobs:
  auto-label:
    runs-on: ubuntu-latest

    permissions:
      issues: write

    steps:
      - name: Initialize dynamic labels
        id: set-labels
        run: |
          echo "labels=" >> $GITHUB_ENV

          # Check for keywords and dynamically add labels
          if echo "${{ github.event.issue.title }}" | grep -i "bug"; then
            echo "labels=bug" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "feature"; then
            echo "labels=feature" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "enhancement"; then
            echo "labels=enhancement" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "documentation"; then
            echo "labels=documentation" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "refactor"; then
            echo "labels=refactor" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "test"; then
            echo "labels=test" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "design"; then
            echo "labels=design" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "security"; then
            echo "labels=security" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "performance"; then
            echo "labels=performance" >> $GITHUB_ENV
          fi
          if echo "${{ github.event.issue.title }}" | grep -i "research"; then
            echo "labels=research" >> $GITHUB_ENV
          fi

      - name: Apply labels based on title
        uses: actions-ecosystem/action-add-labels@v1
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          labels: ${{ env.labels }}
