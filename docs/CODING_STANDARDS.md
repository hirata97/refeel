# コーディング規則とパターン

## コード規則

### 基本規則
1. **命名規則**: Vue標準規則に従う
2. **パッケージマネージャ**: npm使用
3. **型チェック**: TypeScript必須
4. **リンティング**: ESLint + Prettier

### TypeScript型安全性ルール
5. **any型の禁止**: `any`型の使用を避け、具体的な型または`unknown`型を使用
6. **type-only import**: 型のみを使用する場合は`import type`を使用
7. **未使用変数・import**: 未使用の変数、import、引数は削除または`_`プレフィックスを使用
8. **型アサーション**: 必要最小限にとどめ、型安全性を保つ
9. **strict mode**: `tsconfig.json`でstrict設定を有効化

### コード品質ルール
10. **関数型定義**: 汎用的な関数では`(...args: unknown[]) => unknown`を避け、具体的な型を定義
11. **例外処理**: catch文で例外変数が未使用の場合は省略
12. **型互換性**: 異なる型システム間（Vue3, Chart.js等）では適切な型キャスト

## テストパターン

- **テストファイル命名**: `正常系または異常系_コンポーネント名_ナンバリング.spec.js`
- **例**: `normal_LoginPage_01.spec.js`, `exception_LoginPage_01.spec.js`
- **テストディレクトリ**: `tests/[コンポーネント名]/`
- **ユニットテスト**: Vitest
- **E2Eテスト**: Playwright

## Git ワークフロー

- **メインブランチ**: main
- **フィーチャーブランチ**: `feature/機能名` or `issue/番号-説明`
- **コミットメッセージ**: Conventional Commits形式
- **PR**: mainブランチに向けて作成

## 重要な注意点

- TypeScriptの型エラーは必ず解決してからコミット
- リンティング・フォーマットルールに従う
- テストの実行確認を忘れずに行う
- Supabase環境変数の設定確認
- 自動化スクリプトを活用した効率的な開発フロー推奨
- Issue作成時は適切なラベル（priority、size、type）を付与
- **セキュリティ**: 入力値検証とサニタイゼーションを必ず実装

## コードレビュー基準

### 必須チェック項目

- [ ] TypeScript型エラーなし (`npm run type-check`)
- [ ] ESLintエラーなし (`npm run lint`)
- [ ] テストが通る (`npm run test:unit`)
- [ ] 適切なコメント・ドキュメント
- [ ] セキュリティ考慮事項の確認
- [ ] 入力値バリデーションの実装
- [ ] データサニタイゼーションの実装

### 型安全性チェック項目
- [ ] `any`型の使用がない
- [ ] type-only importが適切に使用されている
- [ ] 未使用変数・importが存在しない
- [ ] 汎用的な関数型定義で具体的な型が使用されている
- [ ] 型アサーションが最小限に抑えられている

### 推奨事項

- パフォーマンスの考慮
- アクセシビリティの配慮
- モバイル対応
- エラーハンドリングの実装

## 開発プロセスルール

### コミット前の必須チェック
```bash
# 型チェック
npm run type-check

# リンティング（自動修正含む）
npm run lint

# テスト実行
npm run test:unit
```

### 継続的品質管理
- **定期的な型安全性監査**: 月1回、any型使用状況をレビュー
- **ESLintルールの段階的強化**: 新しいルールを段階的に導入
- **型定義の改善**: 外部ライブラリの型定義を継続的に改善

### 自動化の推進
- **pre-commit hooks**: husky + lint-stagedで自動チェック
- **CI/CDパイプライン**: GitHub Actionsで自動テスト・型チェック
- **コード品質メトリクス**: SonarQube等の品質測定ツール導入検討

### 教育・啓発
- **TypeScript型安全性ガイドライン**: チーム内での型安全性に関する知識共有
- **コードレビューでの指摘事項**: 型安全性に関する共通的な指摘事項の文書化
- **ベストプラクティス集**: 過去の問題事例とその解決策を蓄積